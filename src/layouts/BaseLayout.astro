---
import site from "../content/site.json";

const siteName = site.clinic_name || site.name || "ClÃ­nica";
const initials = site.initials || "VM";

const {
  title = siteName,
  description = "Medicina estÃ©tica con enfoque en seguridad y resultados naturales.",
} = Astro.props;

const year = new Date().getFullYear();

// Colores (del admin/site.json)
const accent = String(site.accent_color || "#0F766E").trim();
const accent2 = String(site.accent_color_2 || "#06B6D4").trim();

// Fondo + ancho + separaciÃ³n del menÃº
const bg = String(site.bg_color || "#ffffff").trim();
const maxWidth = String(site.max_width || "1120px").trim();
const navLinksGap = String(site.nav_links_gap || "22px").trim();

// Espacios verticales
const homeGapServicesComplications = String(site.home_gap_services_complications || "64px").trim();
const homeGapCoverServices = String(site.home_gap_cover_services || "48px").trim();
const homeGapComplicationsSocial = String(site.home_gap_complications_social || "64px").trim();
const homeGapSocialFooter = String(site.home_gap_social_footer || "56px").trim();

// WhatsApp
const whatsappNumber = String(site.whatsapp || "").replace(/\D/g, "");
const whatsappLink = `https://wa.me/${whatsappNumber}`;

// Booking
const bookingUrl = String(site.booking_url || "").trim() || "/contacto/";

// Logo
const logoImage = String(site.logo_image || "").trim();

// Footer
const footerClinicName = site.footer?.clinic_name || site.clinic_name || site.name || siteName;
const footerCity = site.footer?.city || site.city || "";
const footerEmail = site.footer?.email || site.email || "";
const footerPoliciesLabel = site.footer?.policies_label || "PolÃ­ticas";
const footerPoliciesUrl = site.footer?.policies_url || "/politicas";

// Navbar items (admin)
const navbarItems =
  Array.isArray(site?.navbar?.items) && site.navbar.items.length
    ? site.navbar.items
    : [];

// Labels del mega menÃº (admin)
const treatmentsLabel = site?.navbar?.treatments_label || "Tratamientos mÃ©dicos";
const treatmentsFacialTitle = site?.navbar?.treatments_facial_title || "Medicina estÃ©tica facial";
const treatmentsCorporalTitle = site?.navbar?.treatments_corporal_title || "Medicina estÃ©tica corporal";

// ===== Tratamientos desde Markdown (orden estable + sin duplicados) =====
function slugFromFilepath(fp: string) {
  const name = String(fp).split("/").pop() || "";
  return name.replace(/\.mdx?$/i, "");
}

const treatmentModules = import.meta.glob(
  [
    "../content/treatments/**/*.{md,mdx}",
    "../content/tratamientos/**/*.{md,mdx}",
  ],
  { eager: true }
);

const rawTreatments = Object.entries(treatmentModules)
  .map(([filepath, mod]: any) => {
    const fm = mod?.frontmatter || {};
    const slug =
      String(fm.slug || "").trim() ||
      String(slugFromFilepath(filepath)).trim();

    const category = String(fm.category || "facial").toLowerCase().trim(); // facial | corporal
    const label = String(fm.menu_label || fm.title || slug).trim();
    const order = Number.isFinite(Number(fm.order)) ? Number(fm.order) : 999;

    // permite ocultar pÃ¡ginas del mega menÃº principal (para sub-tratamientos)
    const hideFromMenu = Boolean(fm.hide_from_menu || fm.hideFromMenu || fm.hidden_in_menu);

    // Sub-tratamientos (children) definidos en frontmatter del tratamiento padre
    const childrenRaw = Array.isArray(fm.children) ? fm.children : [];
    const children = childrenRaw
      .map((c: any) => {
        const cLabel = String(c?.label || c?.title || "").trim();
        const cSlug = String(c?.slug || "").trim();
        return cLabel && cSlug
          ? {
              label: cLabel,
              slug: cSlug,
              href: `/tratamientos-medicos/${category}/${cSlug}/`,
            }
          : null;
      })
      .filter(Boolean);

    return {
      category,
      slug,
      label,
      order,
      hideFromMenu,
      href: `/tratamientos-medicos/${category}/${slug}/`,
      children,
    };
  })
  .filter((x) => x.label && x.slug && (x.category === "facial" || x.category === "corporal"));

// Dedup: category+slug (evita duplicados si existe en 2 carpetas)
const uniqMap = new Map<string, any>();
for (const t of rawTreatments) {
  const key = `${t.category}:${t.slug}`;
  if (!uniqMap.has(key)) {
    uniqMap.set(key, t);
  } else {
    const prev = uniqMap.get(key);

    // MantÃ©n el que tenga menor order; si empatan, conserva children si el otro no tiene
    if (t.order < prev.order) {
      uniqMap.set(key, t);
    } else if ((!prev.children || prev.children.length === 0) && t.children?.length) {
      prev.children = t.children;
      uniqMap.set(key, prev);
    }
  }
}

const treatmentsAll = Array.from(uniqMap.values());

const sortStable = (a: any, b: any) =>
  (a.order - b.order) ||
  a.label.localeCompare(b.label, "es", { sensitivity: "base" });

// solo listamos como â€œprincipalesâ€ los que NO estÃ¡n ocultos
const treatmentsFacial = treatmentsAll
  .filter((x) => x.category === "facial" && !x.hideFromMenu)
  .sort(sortStable);

const treatmentsCorporal = treatmentsAll
  .filter((x) => x.category === "corporal" && !x.hideFromMenu)
  .sort(sortStable);

// Link principal del botÃ³n (click navega a â€œlista de tratamientosâ€)
const treatmentsMainHref =
  String(
    navbarItems.find((x: any) => x?.type === "treatments")?.href || ""
  ).trim() || "/tratamientos-medicos/facial/"; // (por ahora)
---

<!doctype html>
<html
  lang="es"
  style={`--bg:${bg};--max:${maxWidth};--nav-gap:${navLinksGap};--home-gap-sc:${homeGapServicesComplications};--home-gap-cs:${homeGapCoverServices};--home-gap-ccs:${homeGapComplicationsSocial};--home-gap-sf:${homeGapSocialFooter};--accent:${accent};--accent2:${accent2};`}
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <style>
      :root{
        --bg: #ffffff;
        --max: 1120px;
        --nav-gap: 22px;
        --accent: #0F766E;
        --accent2: #06B6D4;

        --home-gap-sc: 64px;
        --home-gap-cs: 48px;
        --home-gap-ccs: 64px;
        --home-gap-sf: 56px;

        --text: #0f172a;
        --muted: #64748b;
        --line: #e2e8f0;
      }

      *{ box-sizing:border-box; }
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        color:var(--text);
        background: var(--bg);
        line-height:1.55;
      }
      a{ color: inherit; text-decoration: none; }
      .container{ max-width: var(--max); margin:0 auto; padding: 18px; }

      /* ===== Header (2 lÃ­neas, premium) ===== */
      .header{
        position: sticky;
        top: 0;
        z-index: 50;
        background: rgba(255,255,255,.92);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(15,23,42,.10);
        transition: transform .22s ease;
        will-change: transform;
      }
      .header.header--hide{ transform: translateY(-110%); }

      .nav-top{
        display:flex;
        align-items:center;
        justify-content:center;
        padding: 10px 0 6px;
      }
      .brand{
        display:flex;
        align-items:center;
        gap: 12px;
      }
      .brand-badge{
        width: 46px;
        height: 46px;
        border-radius: 999px;
        overflow:hidden;
        border: 1px solid rgba(15,23,42,.12);
        background: #fff;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .brand-badge img{
        width:100%;
        height:100%;
        object-fit:cover;
        display:block;
      }
      .brand-initials{
        font-weight: 900;
        letter-spacing:.08em;
        font-size: 14px;
        color: rgba(15,23,42,.75);
      }
      .brand-name{
        font-family: ui-serif, Georgia, "Times New Roman", serif;
        font-weight: 700;
        letter-spacing: .06em;
        text-transform: uppercase;
        font-size: 30px;
        line-height: 1;
        color: rgba(15,23,42,.88);
        white-space: nowrap;
      }

      .nav-bottom{
        position: relative; /* para posicionar dropdowns */
        border-top: 1px solid rgba(15,23,42,.06);
        padding: 10px 0 12px;
      }

      .nav-row{
        display:grid;
        grid-template-columns: 1fr auto 1fr;
        align-items:center;
        gap: 12px;
      }

      .nav-links{
        grid-column: 2;
        display:flex;
        align-items:center;
        justify-content:center;
        gap: var(--nav-gap);
        flex-wrap: nowrap;
      }

      .nav-link{
        font-size: 12px;
        letter-spacing: .08em;
        text-transform: uppercase;
        color: rgba(15,23,42,.62);
        font-weight: 700;
        padding: 6px 4px;
        white-space: nowrap;
      }
      .nav-link:hover{ color: rgba(15,23,42,.88); }

      .caret{
        margin-left: 6px;
        font-size: 10px;
        opacity:.55;
      }

      /* CTA derecha */
      .nav-cta{
        grid-column: 3;
        justify-self: end;
        display:flex;
        gap:10px;
        align-items:center;
      }
      .btn{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        gap:10px;
        padding: 10px 14px;
        border-radius: 999px;
        border: 1px solid rgba(15,23,42,.12);
        background: rgba(255,255,255,.95);
        color: rgba(15,23,42,.86);
        font-weight: 800;
        white-space: nowrap;
      }
      .btn:hover{ background: rgba(15,23,42,.04); }
      .btn-primary{
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        border: none;
        color: #fff;
      }

      /* ===== Dropdown simple (hover) ===== */
      .nav-item{ position: relative; }
      .dd-panel{
        position:absolute;
        top: calc(100% + 14px);
        left: 50%;
        transform: translate(-50%, 10px);
        min-width: 240px;
        background: rgba(255,255,255,.98);
        border-radius: 14px;
        box-shadow: 0 18px 50px rgba(2,6,23,.10);
        padding: 14px 16px;
        opacity: 0;
        pointer-events: none;
        transition: opacity .18s ease, transform .18s ease;
      }
      .nav-item:hover > .dd-panel,
      .nav-item:focus-within > .dd-panel{
        opacity: 1;
        transform: translate(-50%, 0);
        pointer-events: auto;
      }
      .dd-panel a{
        display:block;
        padding: 8px 0;
        font-size: 12px;
        letter-spacing: .06em;
        text-transform: uppercase;
        color: rgba(15,23,42,.60);
        font-weight: 700;
      }
      .dd-panel a:hover{ color: rgba(15,23,42,.90); }

      /* ===== Mega menu (Tratamientos) â€” sin recuadritos ===== */
      .nav-item--mega{ position: static; }
      .mega-panel{
        position:absolute;
        left: 0;
        right: 0;
        top: calc(100% + 14px);
        margin: 0 auto;
        width: min(var(--max), 92vw);
        background: rgba(255,255,255,.98);
        border-radius: 18px;
        box-shadow: 0 18px 60px rgba(2,6,23,.10);
        padding: 26px 22px;
        opacity: 0;
        transform: translateY(12px);
        pointer-events: none;
        transition: opacity .18s ease, transform .18s ease;
      }
      .nav-item--mega:hover > .mega-panel,
      .nav-item--mega:focus-within > .mega-panel{
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }

      .mega-grid{
        display:grid;
        grid-template-columns: 3fr 1.6fr;
        gap: 36px;
      }

      .mega-title{
        font-size: 12px;
        letter-spacing: .10em;
        text-transform: uppercase;
        font-weight: 700;
        color: rgba(15,23,42,.55);
        margin: 0 0 14px;
      }

      .mega-items{ column-gap: 34px; }
      .mega-items.cols-3{ columns: 3; }
      .mega-items.cols-2{ columns: 2; }

      .mega-block{
        break-inside: avoid;
        margin: 0 0 14px;
      }

      .mega-link{
        display:block;
        padding: 6px 0;
        font-size: 12px;
        letter-spacing: .06em;
        text-transform: uppercase;
        font-weight: 700;
        color: rgba(15,23,42,.55);
      }
      .mega-link:hover{ color: rgba(15,23,42,.90); }

      .mega-children{
        margin-top: 6px;
        padding-left: 10px;
        border-left: 1px solid rgba(15,23,42,.10);
      }
      .mega-sublink{
        display:block;
        padding: 4px 0;
        font-size: 11px;
        letter-spacing: .05em;
        text-transform: uppercase;
        font-weight: 650;
        color: rgba(15,23,42,.48);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .mega-sublink:hover{ color: rgba(15,23,42,.90); }

      /* Placeholder premium (corporal) */
      .mega-soon{
        display:block;
        padding: 6px 0;
        font-size: 12px;
        letter-spacing: .10em;
        text-transform: uppercase;
        font-weight: 700;
        color: rgba(15,23,42,.40);
      }

      /* ===== Mobile ===== */
      .nav-mobile{ display:none; margin-left:auto; position: relative; }
      .burger{
        list-style:none;
        cursor:pointer;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(15,23,42,.12);
        background: rgba(255,255,255,.92);
        font-weight: 900;
        user-select: none;
      }
      .burger::-webkit-details-marker{ display:none; }

      .mobile-panel{
        position:absolute;
        right: 0;
        top: calc(100% + 12px);
        width: min(420px, 92vw);
        background: rgba(255,255,255,.98);
        border: 1px solid rgba(15,23,42,.10);
        border-radius: 16px;
        padding: 12px;
        box-shadow: 0 16px 40px rgba(2,6,23,.12);
        display:flex;
        flex-direction: column;
        gap: 10px;
        z-index: 70;
      }

      details.mdd > summary{
        list-style:none;
        cursor:pointer;
        padding: 12px 12px;
        border-radius: 12px;
        border: 1px solid rgba(15,23,42,.10);
        background: rgba(255,255,255,.92);
        font-weight: 900;
        display:flex;
        align-items:center;
        justify-content: space-between;
        gap: 10px;
      }
      details.mdd > summary::-webkit-details-marker{ display:none; }

      .mdd-panel{
        display:flex;
        flex-direction: column;
        gap: 8px;
        padding: 10px 0 0 0;
      }
      .mdd-panel a{
        padding: 12px 12px;
        border-radius: 12px;
        border: 1px solid rgba(15,23,42,.08);
        background: rgba(15,23,42,.02);
        font-weight: 800;
      }

      .mobile-cta{
        display:flex;
        gap: 10px;
        margin-top: 4px;
      }
      .mobile-cta .btn{ flex: 1; }

      @media (max-width: 980px){
        .nav-cta{ display:none; }
        .nav-links{ display:none; }
        .nav-row{ grid-template-columns: 1fr auto; }
        .nav-mobile{ display:block; justify-self: end; grid-column: 2; }
        .brand-name{ font-size: 22px; }
      }
      @media (max-width: 520px){
        .brand-name{ font-size: 18px; letter-spacing:.04em; }
      }

      /* Footer */
      .site-footer{
        margin-top: var(--home-gap-sf);
        border-top: 1px solid var(--line);
        padding: 26px 0;
      }
      .footer-inner{
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
        color: var(--muted);
      }
      .footer-brand{
        color: var(--text);
        font-weight: 800;
        letter-spacing: .2px;
      }
      .footer-heading{
        font-size: 12px;
        opacity: .65;
        margin-bottom: 6px;
      }
      .footer-link:hover{
        text-decoration: underline;
        text-underline-offset: 3px;
      }
      @media (min-width: 768px){
        .footer-inner{
          grid-template-columns: 1fr 1fr 1fr;
          gap: 24px;
          align-items: start;
        }
        .footer-center{ text-align: center; }
        .footer-right{ text-align: right; }
      }

      /* Floating WhatsApp */
      .wa-fab{
        position: fixed !important;
        right: 18px !important;
        bottom: 18px !important;
        z-index: 2147483647 !important;
        display: inline-flex !important;
        align-items: center !important;
        gap: 10px !important;
        padding: 12px 14px !important;
        border-radius: 999px !important;
        background: #25D366 !important;
        color: #fff !important;
        font-weight: 900 !important;
        box-shadow: 0 14px 30px rgba(0,0,0,0.18) !important;
      }
    </style>
  </head>

  <body>
    <header class="header" id="site-header">
      <div class="container">
        <div class="nav-top">
          <a class="brand" href="/" aria-label={siteName}>
            <span class="brand-badge">
              {logoImage ? <img src={logoImage} alt="Logo" /> : <span class="brand-initials">{initials}</span>}
            </span>
            <span class="brand-name">{siteName}</span>
          </a>
        </div>

        <div class="nav-bottom">
          <nav class="nav-row" aria-label="NavegaciÃ³n principal">
            <div></div>

            <div class="nav-links">
              {navbarItems.map((item: any) => (
                item?.type === "treatments" ? (
                  <div class="nav-item nav-item--mega">
                    <a class="nav-link" href={treatmentsMainHref}>
                      {item.label || treatmentsLabel}<span class="caret">â–¾</span>
                    </a>

                    <div class="mega-panel" role="menu" aria-label="Tratamientos">
                      <div class="mega-grid">
                        <div>
                          <div class="mega-title">{treatmentsFacialTitle}</div>

                          {treatmentsFacial.length ? (
                            <div class="mega-items cols-3">
                              {treatmentsFacial.map((t: any) => (
                                <div class="mega-block">
                                  <a class="mega-link" href={t.href} role="menuitem">{t.label}</a>

                                  {Array.isArray(t.children) && t.children.length ? (
                                    <div class="mega-children">
                                      {t.children.map((c: any) => (
                                        <a class="mega-sublink" href={c.href} role="menuitem">{c.label}</a>
                                      ))}
                                    </div>
                                  ) : null}
                                </div>
                              ))}
                            </div>
                          ) : null}
                        </div>

                        <div>
                          <div class="mega-title">{treatmentsCorporalTitle}</div>

                          {treatmentsCorporal.length ? (
                            <div class="mega-items cols-2">
                              {treatmentsCorporal.map((t: any) => (
                                <div class="mega-block">
                                  <a class="mega-link" href={t.href} role="menuitem">{t.label}</a>

                                  {Array.isArray(t.children) && t.children.length ? (
                                    <div class="mega-children">
                                      {t.children.map((c: any) => (
                                        <a class="mega-sublink" href={c.href} role="menuitem">{c.label}</a>
                                      ))}
                                    </div>
                                  ) : null}
                                </div>
                              ))}
                            </div>
                          ) : (
                            <span class="mega-soon">PrÃ³ximamente</span>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                ) : (
                  Array.isArray(item?.children) && item.children.length ? (
                    <div class="nav-item">
                      <a class="nav-link" href={item.href || "#"}>
                        {item.label}<span class="caret">â–¾</span>
                      </a>
                      <div class="dd-panel" role="menu" aria-label={item.label}>
                        {item.children.map((c: any) => (
                          <a href={c.href} role="menuitem">{c.label}</a>
                        ))}
                      </div>
                    </div>
                  ) : (
                    <a class="nav-link" href={item.href || "#"}>{item.label}</a>
                  )
                )
              ))}
            </div>

            <div class="nav-cta">
              <a class="btn" href={whatsappLink} target="_blank" rel="noreferrer">ðŸ’¬ WhatsApp</a>
              <a class="btn btn-primary" href={bookingUrl} target="_blank" rel="noreferrer">Pide tu cita</a>
            </div>

            <details class="nav-mobile">
              <summary class="burger" aria-label="Abrir menÃº">â˜°</summary>

              <div class="mobile-panel">
                <details class="mdd" open>
                  <summary>
                    <span>{treatmentsLabel}</span>
                    <span class="caret">â–¾</span>
                  </summary>

                  <div class="mdd-panel">
                    <a href={treatmentsMainHref} style="font-weight:900;">Ver todos</a>

                    <strong style="opacity:.75; font-size:12px; text-transform:uppercase; letter-spacing:.06em;">
                      {treatmentsFacialTitle}
                    </strong>

                    {treatmentsFacial.map((t: any) => (
                      <div style="display:flex; flex-direction:column; gap:6px;">
                        <a href={t.href}>{t.label}</a>

                        {Array.isArray(t.children) && t.children.length ? (
                          <div style="display:flex; flex-direction:column; gap:6px; margin-left:12px; opacity:.95;">
                            {t.children.map((c: any) => (
                              <a href={c.href} style="font-size:12px; font-weight:700; opacity:.85;">
                                {c.label}
                              </a>
                            ))}
                          </div>
                        ) : null}
                      </div>
                    ))}

                    <div style="height:10px"></div>

                    <strong style="opacity:.75; font-size:12px; text-transform:uppercase; letter-spacing:.06em;">
                      {treatmentsCorporalTitle}
                    </strong>

                    {treatmentsCorporal.length ? (
                      treatmentsCorporal.map((t: any) => (
                        <div style="display:flex; flex-direction:column; gap:6px;">
                          <a href={t.href}>{t.label}</a>

                          {Array.isArray(t.children) && t.children.length ? (
                            <div style="display:flex; flex-direction:column; gap:6px; margin-left:12px; opacity:.95;">
                              {t.children.map((c: any) => (
                                <a href={c.href} style="font-size:12px; font-weight:700; opacity:.85;">
                                  {c.label}
                                </a>
                              ))}
                            </div>
                          ) : null}
                        </div>
                      ))
                    ) : (
                      <div style="padding:10px 12px; border-radius:12px; border:1px dashed rgba(15,23,42,.16); opacity:.7; font-weight:800;">
                        PrÃ³ximamente
                      </div>
                    )}
                  </div>
                </details>

                {navbarItems.filter((x: any) => x?.type !== "treatments").map((item: any) => (
                  Array.isArray(item?.children) && item.children.length ? (
                    <details class="mdd">
                      <summary>
                        <span>{item.label}</span>
                        <span class="caret">â–¾</span>
                      </summary>
                      <div class="mdd-panel">
                        {item.children.map((c: any) => (<a href={c.href}>{c.label}</a>))}
                      </div>
                    </details>
                  ) : (
                    <a class="btn" href={item.href || "#"} style="border-radius:14px;">{item.label}</a>
                  )
                ))}

                <div class="mobile-cta">
                  <a class="btn" href={whatsappLink} target="_blank" rel="noreferrer">ðŸ’¬ WhatsApp</a>
                  <a class="btn btn-primary" href={bookingUrl} target="_blank" rel="noreferrer">Pide tu cita</a>
                </div>
              </div>
            </details>
          </nav>
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <slot />
      </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div class="footer-inner">
          <div class="footer-col footer-left">
            <div class="footer-brand">{footerClinicName}</div>
          </div>

          <div class="footer-col footer-center">
            <div class="footer-heading">UbicaciÃ³n</div>
            <div>{footerCity}</div>
          </div>

          <div class="footer-col footer-right">
            <div class="footer-heading">Contacto</div>

            {footerEmail ? (
              <a class="footer-link" href={`mailto:${footerEmail}`}>
                {footerEmail}
              </a>
            ) : null}

            <div style="height:6px;"></div>

            <a class="footer-link" href={footerPoliciesUrl}>
              {footerPoliciesLabel}
            </a>
          </div>
        </div>

        <div style="height:10px;"></div>
        <small style="color:var(--muted);opacity:.8;">
          Â© {year} Â· {siteName}
        </small>
      </div>
    </footer>

    <a class="wa-fab" href={whatsappLink} target="_blank" rel="noreferrer" aria-label="WhatsApp">
      ðŸ’¬ WhatsApp
    </a>

    <script is:inline>
      document.addEventListener("click", (e) => {
        const mob = document.querySelector(".nav-mobile");
        if (mob && mob.hasAttribute("open")) {
          const panel = mob.querySelector(".mobile-panel");
          const burger = mob.querySelector(".burger");
          if (panel && panel.contains(e.target)) {
            if (e.target.tagName === "A") mob.removeAttribute("open");
          } else if (burger && burger.contains(e.target)) {
          } else {
            mob.removeAttribute("open");
          }
        }
      });

      (function(){
        const header = document.getElementById("site-header");
        if (!header) return;

        let lastY = window.scrollY || 0;
        let ticking = false;

        const shouldKeepVisible = () => {
          const mobOpen = document.querySelector(".nav-mobile[open]");
          return !!mobOpen;
        };

        const onScroll = () => {
          const y = window.scrollY || 0;
          const goingDown = y > lastY;

          if (y < 60 || shouldKeepVisible()) header.classList.remove("header--hide");
          else if (goingDown) header.classList.add("header--hide");
          else header.classList.remove("header--hide");

          lastY = y;
        };

        window.addEventListener("scroll", () => {
          if (!ticking) {
            window.requestAnimationFrame(() => {
              onScroll();
              ticking = false;
            });
            ticking = true;
          }
        }, { passive: true });
      })();
    </script>
  </body>
</html>
