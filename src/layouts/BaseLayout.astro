---
import site from "../content/site.json";

const siteName = site.clinic_name || site.name || "Cl√≠nica Dr. V√≠ctor Miranda";
const initials = site.initials || "VM";

const {
  title = siteName,
  description = "Medicina est√©tica con enfoque en seguridad y resultados naturales.",
} = Astro.props;

const year = new Date().getFullYear();

// Colores (del admin/site.json)
const accent = String(site.accent_color || "#0F766E").trim();
const accent2 = String(site.accent_color_2 || "#06B6D4").trim();

// ‚úÖ Fondo + ancho + separaci√≥n del men√∫ (del admin/site.json)
const bg = String(site.bg_color || "#ffffff").trim();
const maxWidth = String(site.max_width || "1120px").trim();
const navLinksGap = String(site.nav_links_gap || "16px").trim();

// ‚úÖ Espacios verticales graduables (del admin/site.json)
const homeGapServicesComplications = String(site.home_gap_services_complications || "64px").trim(); // sc
const homeGapCoverServices = String(site.home_gap_cover_services || "48px").trim(); // cs
const homeGapComplicationsSocial = String(site.home_gap_complications_social || "64px").trim(); // ccs
const homeGapSocialFooter = String(site.home_gap_social_footer || "56px").trim(); // sf ‚úÖ NUEVO

// WhatsApp
const whatsappNumber = String(site.whatsapp || "").replace(/\D/g, "");
const whatsappLink = `https://wa.me/${whatsappNumber}`;

// Booking
const bookingUrl = String(site.booking_url || "").trim() || "/contacto/";

// Logo
const logoImage = String(site.logo_image || "").trim();

// Footer (desde site.json.footer con fallback a campos existentes)
const footerClinicName = site.footer?.clinic_name || site.clinic_name || site.name || siteName;
const footerCity = site.footer?.city || site.city || "";
const footerEmail = site.footer?.email || site.email || "";
const footerPoliciesLabel = site.footer?.policies_label || "Pol√≠ticas";
const footerPoliciesUrl = site.footer?.policies_url || "/politicas";
---

<!doctype html>
<html
  lang="es"
  style={`--bg:${bg};--max:${maxWidth};--nav-gap:${navLinksGap};--home-gap-sc:${homeGapServicesComplications};--home-gap-cs:${homeGapCoverServices};--home-gap-ccs:${homeGapComplicationsSocial};--home-gap-sf:${homeGapSocialFooter};--accent:${accent};--accent2:${accent2};`}
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <style>
      :root{
        /* Estos valores se sobreescriben con el style="" del <html> */
        --bg: #ffffff;
        --max: 1120px;
        --nav-gap: 16px;
        --accent: #0F766E;
        --accent2: #06B6D4;

        /* Espacios verticales (defaults) */
        --home-gap-sc: 64px;  /* servicios -> complicaciones */
        --home-gap-cs: 48px;  /* portada -> servicios */
        --home-gap-ccs: 64px; /* complicaciones -> redes */
        --home-gap-sf: 56px;  /* redes -> footer ‚úÖ nuevo */

        --text: #0f172a;
        --muted: #475569;
        --line: #e2e8f0;
        --soft: #f8fafc;
        --soft2:#f1f5f9;

        --radius: 18px;
        --shadow: 0 16px 40px rgba(15,23,42,0.08);
      }

      *{ box-sizing:border-box; }
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        color:var(--text);
        background: var(--bg);
        line-height:1.55;
      }
      a{ color: inherit; text-decoration: none; }
      a.link{ text-decoration: underline; text-underline-offset: 3px; }

      .container{ max-width: var(--max); margin:0 auto; padding: 18px; }

      /* ===== Header / Navbar (estilo m√°s ‚Äúcl√≠nica grande‚Äù) ===== */
      .header{
        position: sticky;
        top: 0;
        z-index: 50;
        background: rgba(255,255,255,.78);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(15,23,42,.10);
      }

      .nav{
        display:flex;
        align-items:center;
        gap:14px;
        flex-wrap: nowrap;
      }

      .brand{
        display:flex;
        align-items:center;
        gap:10px;
        font-weight: 900;
        letter-spacing: .2px;
        min-width: 0;
      }

      .brand span{
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 340px;
      }

      .brand-badge{
        width: 38px;
        height: 38px;
        border-radius: 14px;
        background:
          radial-gradient(90px 40px at 20% 10%, var(--accent2), rgba(255,255,255,0)),
          linear-gradient(135deg, var(--accent), #0f172a);
        color: #fff;
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow: 0 10px 22px rgba(15,23,42,0.18);
        overflow: hidden;
        flex: 0 0 auto;
      }

      .brand-badge img{
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .navlinks{
        margin-left: auto;
        display:flex;
        align-items: center;
        gap: var(--nav-gap);
      }

      .navlinks a{
        padding: 10px 12px;
        border-radius: 12px;
        color: rgba(15,23,42,.78);
        font-weight: 800;
        font-size: 13px;
        letter-spacing: .02em;
        text-transform: uppercase;
      }

      .navlinks a:hover{
        background: rgba(15,23,42,.06);
        color: rgba(15,23,42,.92);
      }

      .nav-cta{
        display:flex;
        gap:10px;
        align-items:center;
        margin-left: 10px;
      }

      /* Buttons */
      .btn{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        gap:10px;
        padding: 11px 14px;
        border-radius: 14px;
        border: 1px solid rgba(15,23,42,.12);
        background: rgba(255,255,255,.95);
        color: rgba(15,23,42,.92);
        font-weight: 900;
        box-shadow: 0 10px 24px rgba(15,23,42,0.05);
        white-space: nowrap;
      }

      .btn:hover{ background: rgba(15,23,42,.05); }

      .btn-primary{
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        border: none;
        color: #fff;
        box-shadow: 0 14px 30px rgba(6,182,212,0.18);
      }

      .btn-primary:hover{ filter: brightness(.97); }

      /* ===== Men√∫ m√≥vil ===== */
      .nav-mobile{
        display:none;
        margin-left: auto;
        position: relative;
      }

      .burger{
        list-style:none;
        cursor:pointer;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(15,23,42,.12);
        background: rgba(255,255,255,.92);
        font-weight: 900;
        user-select: none;
      }

      .burger::-webkit-details-marker{ display:none; }

      .mobile-panel{
        position:absolute;
        right: 0;
        top: calc(100% + 10px);
        width: min(360px, 92vw);
        background: rgba(255,255,255,.98);
        border: 1px solid rgba(15,23,42,.10);
        border-radius: 16px;
        padding: 12px;
        box-shadow: 0 16px 40px rgba(2,6,23,.12);
        display:flex;
        flex-direction: column;
        gap: 8px;
        z-index: 60;
      }

      .mobile-panel a{
        padding: 12px 12px;
        border-radius: 12px;
        color: rgba(15,23,42,.90);
        text-decoration:none;
        border: 1px solid rgba(15,23,42,.08);
        background: rgba(15,23,42,.02);
        font-weight: 800;
      }

      .mobile-panel a:hover{
        background: rgba(15,23,42,.06);
      }

      .mobile-cta{
        display:flex;
        gap: 10px;
        margin-top: 4px;
      }

      .mobile-cta .btn{ flex: 1; }

      @media (max-width: 900px){
        .navlinks{ display:none; }
        .nav-cta{ display:none; }
        .nav-mobile{ display:block; }
        .brand span{ max-width: 200px; }
      }

      @media (max-width: 420px){
        .brand span{ display:none; }
      }

      /* ‚úÖ Footer minimalista */
      .site-footer{
        margin-top: var(--home-gap-sf);
        border-top: 1px solid var(--line);
        padding: 26px 0;
      }

      .footer-inner{
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
        color: var(--muted);
      }

      .footer-brand{
        color: var(--text);
        font-weight: 800;
        letter-spacing: .2px;
      }

      .footer-heading{
        font-size: 12px;
        opacity: .65;
        margin-bottom: 6px;
      }

      .footer-text{
        opacity: .9;
      }

      .footer-link{
        display: inline-block;
        opacity: .9;
        text-decoration: none;
      }

      .footer-link:hover{
        opacity: 1;
        text-decoration: underline;
        text-underline-offset: 3px;
      }

      @media (min-width: 768px){
        .footer-inner{
          grid-template-columns: 1fr 1fr 1fr;
          gap: 24px;
          align-items: start;
        }
        .footer-center{ text-align: center; }
        .footer-right{ text-align: right; }
      }

      /* Floating WhatsApp */
      .wa-fab{
        position: fixed !important;
        right: 18px !important;
        bottom: 18px !important;
        z-index: 2147483647 !important;
        display: inline-flex !important;
        align-items: center !important;
        gap: 10px !important;
        padding: 12px 14px !important;
        border-radius: 999px !important;
        background: #25D366 !important;
        color: #fff !important;
        font-weight: 900 !important;
        box-shadow: 0 14px 30px rgba(0,0,0,0.18) !important;
      }
    </style>
  </head>

  <body>
    <header class="header">
      <div class="container">
        <nav class="nav" aria-label="Navegaci√≥n principal">
          <a class="brand" href="/">
            <span class="brand-badge">
              {logoImage ? <img src={logoImage} alt="Logo" /> : initials}
            </span>
            <span>{siteName}</span>
          </a>

          <!-- Desktop -->
          <div class="navlinks">
            <a href="/">Inicio</a>
            <a href="/clinica/">La Cl√≠nica</a>
            <a href="/servicios/">Servicios</a>
            <a href="/complicaciones/">Complicaciones</a>
            <a href="/contacto/">Contacto</a>
          </div>

          <div class="nav-cta">
            <a class="btn" href={whatsappLink} target="_blank" rel="noreferrer">üí¨ WhatsApp</a>
            <a class="btn btn-primary" href={bookingUrl} target="_blank" rel="noreferrer">Pide tu cita</a>
          </div>

          <!-- Mobile -->
          <details class="nav-mobile">
            <summary class="burger" aria-label="Abrir men√∫">‚ò∞</summary>
            <div class="mobile-panel">
              <a href="/">Inicio</a>
              <a href="/clinica/">La Cl√≠nica</a>
              <a href="/servicios/">Servicios</a>
              <a href="/complicaciones/">Complicaciones</a>
              <a href="/contacto/">Contacto</a>

              <div class="mobile-cta">
                <a class="btn" href={whatsappLink} target="_blank" rel="noreferrer">üí¨ WhatsApp</a>
                <a class="btn btn-primary" href={bookingUrl} target="_blank" rel="noreferrer">Pide tu cita</a>
              </div>
            </div>
          </details>
        </nav>
      </div>
    </header>

    <main>
      <div class="container">
        <slot />
      </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div class="footer-inner">
          <div class="footer-col footer-left">
            <div class="footer-brand">{footerClinicName}</div>
          </div>

          <div class="footer-col footer-center">
            <div class="footer-heading">Ubicaci√≥n</div>
            <div class="footer-text">{footerCity}</div>
          </div>

          <div class="footer-col footer-right">
            <div class="footer-heading">Contacto</div>

            {footerEmail ? (
              <a class="footer-link" href={`mailto:${footerEmail}`}>
                {footerEmail}
              </a>
            ) : null}

            <div style="height:6px;"></div>

            <a class="footer-link" href={footerPoliciesUrl}>
              {footerPoliciesLabel}
            </a>
          </div>
        </div>

        <div style="height:10px;"></div>
        <small style="color:var(--muted);opacity:.8;">
          ¬© {year} ¬∑ {siteName}
        </small>
      </div>
    </footer>

    <a class="wa-fab" href={whatsappLink} target="_blank" rel="noreferrer" aria-label="WhatsApp">
      üí¨ WhatsApp
    </a>

    <!-- Cierra el men√∫ m√≥vil al tocar un link -->
    <script is:inline>
      document.addEventListener("click", (e) => {
        const mob = document.querySelector(".nav-mobile");
        if (!mob) return;

        if (mob.hasAttribute("open")) {
          const panel = mob.querySelector(".mobile-panel");
          const burger = mob.querySelector(".burger");
          if (panel && panel.contains(e.target)) {
            if (e.target.tagName === "A") mob.removeAttribute("open");
          } else if (burger && burger.contains(e.target)) {
            // click en burger: no hacer nada
          } else {
            // click fuera
            mob.removeAttribute("open");
          }
        }
      });
    </script>
  </body>
</html>
