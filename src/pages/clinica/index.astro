---
import BaseLayout from "../../layouts/BaseLayout.astro";
import site from "../../content/site.json";
import clinic from "../../content/home_clinic.json";

const siteName = site.clinic_name || site.name || "Clínica Dr. Víctor Miranda";

function resolveImageSrc(src) {
  let s = String(src || "").trim();
  if (!s) return "";
  if (s.startsWith("http://") || s.startsWith("https://")) return s;
  if (s.startsWith("public/")) s = s.replace(/^public\//, "");
  if (!s.startsWith("/")) s = `/${s}`;
  return s;
}

const enabled = clinic?.enabled !== false;

const eyebrow = clinic?.eyebrow || "Nuestra esencia";
const title = clinic?.title || "La Clínica";

const image = clinic?.image ? resolveImageSrc(clinic.image) : "";
const imageAlt = clinic?.image_alt || title;

const missionTitle = clinic?.mission?.title || "Misión";
const missionText = clinic?.mission?.text || "";

const visionTitle = clinic?.vision?.title || "Visión";
const visionText = clinic?.vision?.text || "";

const valuesTitle = clinic?.values?.title || "Valores";
const valuesText = clinic?.values?.text || "";
// Valores: soporta "items" o "bullets" (según cómo lo guarde el Admin)
const valuesItemsRaw = clinic?.values?.items ?? clinic?.values?.bullets ?? [];

// Normaliza: si vienen strings, los convierte a { text: "..." }
const valuesItems = Array.isArray(valuesItemsRaw)
  ? valuesItemsRaw
      .map((v) => (typeof v === "string" ? { text: v } : v))
      .filter((v) => v && typeof v.text === "string" && v.text.trim().length > 0)
  : [];

---

<BaseLayout
  title={`${siteName} | ${title}`}
  description="Conoce la misión, visión y valores de nuestra clínica."
>
  <section class="clinic">
    <div class="clinic-head">
      <div class="clinic-eyebrow">{eyebrow}</div>
      <h1 class="clinic-title">{title}</h1>
    </div>

    {enabled ? (
      <>
        <div class="clinic-hero">
          {image ? (
            <img src={image} alt={imageAlt} loading="lazy" />
          ) : (
            <div class="clinic-hero-placeholder" aria-hidden="true"></div>
          )}
        </div>

        <div class="clinic-grid">
          <article class="clinic-card">
            <div class="clinic-card-title">{missionTitle}</div>
            <p class="clinic-card-text">{missionText}</p>
          </article>

          <article class="clinic-card">
            <div class="clinic-card-title">{visionTitle}</div>
            <p class="clinic-card-text">{visionText}</p>
          </article>

          <article class="clinic-card clinic-card--wide">
            <div class="clinic-card-title">{valuesTitle}</div>

            {valuesText ? <p class="clinic-card-text">{valuesText}</p> : null}

            {valuesItems?.length ? (
              <ul class="clinic-values">
                {valuesItems.map((it) => <li>{it.text}</li>)}
              </ul>
            ) : null}
          </article>
        </div>
      </>
    ) : (
      <div class="clinic-disabled">Esta sección está desactivada en el Admin.</div>
    )}
  </section>

  <style>
    .clinic{ padding: 22px 0 10px; }
    .clinic-head{ margin-bottom: 14px; }
    .clinic-eyebrow{
      font-size: 12px;
      letter-spacing: .24em;
      text-transform: uppercase;
      opacity: .7;
      margin-bottom: 10px;
    }
    .clinic-title{
      margin: 0;
      font-size: 40px;
      letter-spacing: -0.45px;
      line-height: 1.06;
    }

    .clinic-hero{
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 18px 50px rgba(15,23,42,0.10);
      background: rgba(255,255,255,0.35);
    }
    .clinic-hero img{
      width: 100%;
      height: auto;
      display:block;
      aspect-ratio: 16 / 7;
      object-fit: cover;
    }
    .clinic-hero-placeholder{
      width: 100%;
      aspect-ratio: 16 / 7;
      background:
        radial-gradient(600px 260px at 20% 20%, rgba(255,255,255,0.75), rgba(255,255,255,0)),
        linear-gradient(135deg, rgba(255,255,255,0.55), rgba(0,0,0,0.06));
      border: 1px dashed rgba(0,0,0,0.12);
    }

    .clinic-grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 16px;
    }
    .clinic-card{
      grid-column: span 6;
      border-radius: 18px;
      border: 1px solid rgba(15,23,42,0.10);
      background: rgba(255,255,255,0.70);
      box-shadow: 0 16px 40px rgba(15,23,42,0.06);
      padding: 16px 16px 14px;
      backdrop-filter: blur(10px);
    }
    .clinic-card--wide{ grid-column: span 12; }

    .clinic-card-title{
      font-weight: 900;
      letter-spacing: .18em;
      text-transform: uppercase;
      font-size: 12px;
      opacity: .75;
      margin-bottom: 10px;
    }
    .clinic-card-text{
      margin: 0;
      line-height: 1.7;
      opacity: .90;
      max-width: 78ch;
    }
    .clinic-values{
      margin: 12px 0 0;
      padding-left: 18px;
      line-height: 1.7;
      opacity: .92;
    }

    .clinic-disabled{
      border: 1px solid rgba(15,23,42,0.10);
      border-radius: 18px;
      padding: 14px 16px;
      background: rgba(255,255,255,0.70);
      opacity: .85;
    }

    @media (max-width: 980px){
      .clinic-title{ font-size: 32px; }
      .clinic-card{ grid-column: span 12; }
      .clinic-hero img, .clinic-hero-placeholder{ aspect-ratio: 16 / 10; }
    }
  </style>
</BaseLayout>
