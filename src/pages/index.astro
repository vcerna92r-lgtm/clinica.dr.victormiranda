---
import BaseLayout from "../layouts/BaseLayout.astro";
import site from "../content/site.json";
import home from "../content/home.json";
import homeServices from "../content/home_services.json";

const siteName = site.clinic_name || site.name || "Cl√≠nica Dr. V√≠ctor Miranda";
const bookingUrl = String(site.booking_url || "").trim() || "/contacto/";

const whatsappNum = String(site.whatsapp || "").trim();
const whatsappMessage = encodeURIComponent(String(site.whatsapp_message || "").trim() || "Hola, quiero agendar una valoraci√≥n.");
const whatsappUrl = whatsappNum ? `https://wa.me/${whatsappNum}?text=${whatsappMessage}` : "https://wa.me/50587355501";

function resolveImageSrc(src) {
  let s = String(src || "").trim();
  if (!s) return "";
  if (s.startsWith("http://") || s.startsWith("https://")) return s;
  if (s.startsWith("public/")) s = s.replace(/^public\//, "");
  if (!s.startsWith("/")) s = `/${s}`;
  return s;
}

function fontClass(v) {
  return String(v || "system") === "serif" ? "font-serif" : "font-system";
}
function titleSizeClass(v) {
  const s = String(v || "xl");
  if (s === "md") return "title-md";
  if (s === "lg") return "title-lg";
  return "title-xl";
}
function textSizeClass(v) {
  const s = String(v || "md");
  if (s === "sm") return "text-sm";
  if (s === "lg") return "text-lg";
  return "text-md";
}

/* ‚úÖ NUEVO: forma de imagen para Servicios principales */
function shapeClass(shape) {
  const s = String(shape || "rounded").toLowerCase();
  if (s === "circle") return "hs-shape-circle";
  if (s === "square") return "hs-shape-square";
  return "hs-shape-rounded";
}
---

<BaseLayout
  title={`${siteName} | Medicina est√©tica`}
  description="Tratamientos personalizados con enfoque en seguridad, naturalidad y seguimiento cl√≠nico."
>
  <!-- ‚úÖ PORTADA (como la imagen): foto + qui√©n soy -->
  <section class="cover">
    <div class="cover-grid">
      <div class="cover-photo">
        {home.hero_image ? (
          <img src={resolveImageSrc(home.hero_image)} alt={home.hero_title || siteName} loading="lazy" />
        ) : (
          <div class="photo-placeholder" aria-hidden="true"></div>
        )}
      </div>

      <div class={`cover-copy ${fontClass(home.hero_font_family)} ${textSizeClass(home.hero_text_size)}`}>
        <h1 class={titleSizeClass(home.hero_title_size)}>{home.hero_title || "Tu nombre"}</h1>

        {home.hero_bullets?.length ? (
          <ul class="bullets">
            {home.hero_bullets.map((b) => <li>{b.text}</li>)}
          </ul>
        ) : null}

        {home.hero_paragraphs?.map((p) => <p class="para">{p.text}</p>)}
      </div>
    </div>
  </section>

  <!-- ‚úÖ Servicios principales (desde admin / home_services.json) -->
  <section class="section">
    <div class="section-title">
      <div>
        <h2>{homeServices.section_title || "Servicios principales"}</h2>
        {homeServices.section_subtitle && <p class="sub">{homeServices.section_subtitle}</p>}
      </div>
      <a class="link" href="/servicios/">Ver todos ‚Üí</a>
    </div>

    <div class="home-services-grid">
      {homeServices.items?.map((item) => (
        <article class="home-service-card">
          <div class={`home-service-media ${shapeClass(item.image_shape)}`}>
            {item.image ? (
              <img src={resolveImageSrc(item.image)} alt={item.name || "Servicio"} loading="lazy" />
            ) : (
              <div class="media-placeholder" aria-hidden="true"></div>
            )}
          </div>

          <div class="home-service-body">
            <h3>{item.name}</h3>
            {item.description && <p>{item.description}</p>}
          </div>
        </article>
      ))}
    </div>
  </section>

  <section class="section">
    <div class="callout">
      <span class="dot" aria-hidden="true"></span>
      <div>
        <strong>Manejo de complicaciones</strong>
        <p class="sub">
          Evaluaci√≥n m√©dica + plan + seguimiento para casos complejos.
          Si algo no sali√≥ como esperabas, podemos ayudarte a encaminarlo de forma segura.
        </p>
        <div class="row" style="margin-top:12px;">
          <a class="btn btn-primary" href="/complicaciones/">Ver manejo</a>
          <a class="btn" href={bookingUrl}>Solicitar evaluaci√≥n</a>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="section-title">
      <div>
        <h2>Testimonios</h2>
        <p class="sub">Puedes reemplazar esto luego por testimonios reales.</p>
      </div>
    </div>

    <div class="grid">
      <div class="card col-4">
        <h3>‚ÄúResultados naturales‚Äù</h3>
        <p>Me encant√≥ que se viera sutil y armonioso.</p>
      </div>
      <div class="card col-4">
        <h3>‚ÄúAtenci√≥n y seguimiento‚Äù</h3>
        <p>Me explicaron todo con claridad y me sent√≠ segura/o.</p>
      </div>
      <div class="card col-4">
        <h3>‚ÄúProfesional y cuidadoso‚Äù</h3>
        <p>Se nota el enfoque m√©dico y la seguridad.</p>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="card soft">
      <h2 style="margin:0 0 8px;">¬øListo para tu valoraci√≥n?</h2>
      <p class="sub">Agenda o escr√≠benos por WhatsApp. Respuesta r√°pida.</p>
      <div class="row" style="margin-top:12px;">
        <a class="btn btn-primary" href={bookingUrl}>Reservar</a>
        <a class="btn" href={whatsappUrl} target="_blank" rel="noreferrer">üí¨ WhatsApp</a>
      </div>
    </div>
  </section>

  <style>
    /* ‚úÖ Estilos solo para la PORTADA */
    .cover{ padding-top: 26px; padding-bottom: 10px; }

    .cover-grid{
      display: grid;
      grid-template-columns: 0.95fr 1.05fr;
      gap: 22px;
      align-items: center;
    }

    .cover-photo{
      width: min(560px, 78vw);
      aspect-ratio: 1 / 1;
      border-radius: 999px;
      overflow: hidden;
      background: rgba(255,255,255,0.35);
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 16px 40px rgba(15,23,42,0.08);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .cover-photo img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
    }

    .photo-placeholder{
      width: 100%;
      height: 100%;
      background:
        radial-gradient(500px 240px at 20% 20%, rgba(255,255,255,0.70), rgba(255,255,255,0)),
        linear-gradient(135deg, rgba(255,255,255,0.55), rgba(0,0,0,0.05));
      border: 1px dashed rgba(0,0,0,0.12);
    }

    .font-system{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .font-serif{ font-family: ui-serif, Georgia, "Times New Roman", Times, serif; }

    .title-xl{ font-size: 44px; letter-spacing: -0.6px; margin: 0 0 10px; line-height: 1.05; }
    .title-lg{ font-size: 38px; letter-spacing: -0.5px; margin: 0 0 10px; line-height: 1.1; }
    .title-md{ font-size: 32px; letter-spacing: -0.4px; margin: 0 0 10px; line-height: 1.15; }

    .text-lg{ font-size: 18px; }
    .text-md{ font-size: 16px; }
    .text-sm{ font-size: 14px; }

    .bullets{ margin: 0 0 12px; padding-left: 18px; line-height: 1.6; }
    .para{ margin: 10px 0 0; line-height: 1.65; opacity: 0.92; }

    @media (max-width: 980px){
      .cover-grid{ grid-template-columns: 1fr; }
      .cover-photo{ width: min(520px, 85vw); margin: 0 auto; }
    }

    /* ‚úÖ Servicios principales (tarjetas sin bot√≥n) */
    .home-services-grid{
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(12, 1fr);
    }

    .home-service-card{
      grid-column: span 4;
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 16px 40px rgba(15,23,42,0.06);
      background: #F5F5F2;
      display: flex;
      flex-direction: column;
      min-height: 100%;
    }

    .home-service-media{
      width: 100%;
      aspect-ratio: 16 / 10;
      overflow: hidden;
      padding: 14px;
      background: rgba(255,255,255,0.35);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .home-service-media img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 16px;
      display: block;
    }

    .home-service-body{
      padding: 14px 16px 16px;
      display:flex;
      flex-direction: column;
      gap: 8px;
    }

    .home-service-body h3{
      margin: 0;
      font-size: 18px;
      letter-spacing: -0.2px;
    }

    .home-service-body p{
      margin: 0;
      line-height: 1.5;
      opacity: 0.9;
    }

    /* ‚úÖ NUEVO: Formas de imagen */
    .home-service-media .media-placeholder{
      width: 100%;
      height: 100%;
      border-radius: 16px;
    }

    .home-service-media.hs-shape-square img,
    .home-service-media.hs-shape-square .media-placeholder{
      border-radius: 0;
    }

    .home-service-media.hs-shape-rounded img,
    .home-service-media.hs-shape-rounded .media-placeholder{
      border-radius: 16px;
    }

    .home-service-media.hs-shape-circle{
      aspect-ratio: 1 / 1;
      padding: 18px;
    }
    .home-service-media.hs-shape-circle img,
    .home-service-media.hs-shape-circle .media-placeholder{
      border-radius: 999px;
    }

    @media (max-width: 980px){
      .home-service-card{ grid-column: span 6; }
    }
    @media (max-width: 640px){
      .home-service-card{ grid-column: span 12; }
    }
  </style>
</BaseLayout>
