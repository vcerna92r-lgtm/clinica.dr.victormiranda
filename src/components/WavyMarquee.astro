---
const {
  text = "Manejo de complicaciones",
  speed = "normal", // "slow" | "normal" | "fast"
} = Astro.props;

const phrase = String(text || "").trim() || "Manejo de complicaciones";

/* ✅ Mucho más largo para que NUNCA “se corte” en desktop */
const repeated = Array.from({ length: 46 }, () => phrase).join("   ✶   ");

const dur =
  speed === "slow" ? "26s" :
  speed === "fast" ? "12s" :
  "18s";
---

<div class="wavyMarquee" aria-label={phrase} style={`--dur:${dur};`}>
  <svg
    class="wavySvg"
    viewBox="0 0 1200 140"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    aria-hidden="true"
    focusable="false"
  >
    <defs>
      <path
        id="wavePath"
        d="
          M -200 70
          C -60  0,  60 140, 200 70
          S  460  0, 600 70
          S  860 140, 1000 70
          S 1260  0, 1400 70
        "
      />
      <filter id="txtShadow" x="-30%" y="-30%" width="160%" height="160%">
        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(0,0,0,0.18)" />
      </filter>
    </defs>

    <rect class="wavyBand" x="-200" y="22" width="1600" height="96" rx="26" />

    <text class="wavyText" filter="url(#txtShadow)" dominant-baseline="middle">
      <textPath href="#wavePath" xlink:href="#wavePath" startOffset="0%">
        <!-- ✅ Recorrido un poco mayor para que el loop sea más “uniforme” -->
        <animate attributeName="startOffset" from="0%" to="-60%" dur="var(--dur)" repeatCount="indefinite" />
        <tspan>{repeated}</tspan>
      </textPath>
    </text>
  </svg>
</div>

<style>
  .wavyMarquee{
    display:block;
    overflow:hidden;
    margin: 0 0 12px 0;
    transform: rotate(-2deg);
    height: 96px;
  }

  /* ✅ Más ancho en general */
  .wavySvg{
    width: 200%;
    height: 100%;
  }

  .wavyBand{
    fill: rgba(255,255,255,0.58);
  }

  .wavyText{
    font: 900 clamp(26px, 5.2vw, 46px)/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    letter-spacing: .3px;
    fill: #0f172a;
  }

  @media (min-width: 900px){
    .wavyMarquee{ height: 112px; transform: rotate(-1.5deg); }
    /* ✅ Desktop: cubre mejor todo el ancho */
    .wavySvg{ width: 170%; }
    .wavyBand{ fill: rgba(255,255,255,0.45); }
  }
</style>
