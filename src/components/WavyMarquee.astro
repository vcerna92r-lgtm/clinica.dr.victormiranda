---
const {
  text = "Manejo de complicaciones",
  speed = "normal", // "slow" | "normal" | "fast"
} = Astro.props;

const phrase = String(text || "").trim() || "Manejo de complicaciones";

/* Mucho texto para que el loop sea continuo sin necesitar clones */
const repeated = Array.from({ length: 26 }, () => phrase).join("   ✶   ");

const dur =
  speed === "slow" ? "22s" :
  speed === "fast" ? "11s" :
  "16s";
---

<div class="wavyMarquee" aria-label={phrase}>
  <svg
    class="wavySvg"
    viewBox="0 0 1200 140"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    aria-hidden="true"
    focusable="false"
  >
    <defs>
      <!-- Onda serpiente -->
      <path
        id="wavePath"
        d="
          M -200 70
          C -60  0,  60 140, 200 70
          S  460  0, 600 70
          S  860 140, 1000 70
          S 1260  0, 1400 70
        "
      />

      <!-- sombra suave -->
      <filter id="txtShadow" x="-30%" y="-30%" width="160%" height="160%">
        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(0,0,0,0.18)" />
      </filter>
    </defs>

    <!-- banda clara para lectura -->
    <rect class="wavyBand" x="-200" y="22" width="1600" height="96" rx="26" />

    <!-- ✅ SOLO 1 texto: imposible que se “encime” -->
    <text class="wavyText" filter="url(#txtShadow)" dominant-baseline="middle">
      <textPath href="#wavePath" xlink:href="#wavePath" startOffset="0%">
        <!-- Movimiento por startOffset -->
        <animate attributeName="startOffset" from="0%" to="-50%" dur={dur} repeatCount="indefinite" />
        <tspan>{repeated}</tspan>
      </textPath>
    </text>
  </svg>
</div>

<style>
  .wavyMarquee{
    display:block;
    overflow:hidden;
    margin: 0 0 12px 0;
    transform: rotate(-2deg);
    height: 96px;
  }

  .wavySvg{
    width: 170%;
    height: 100%;
  }

  .wavyBand{
    fill: rgba(255,255,255,0.58);
  }

  .wavyText{
    font: 900 clamp(26px, 5.2vw, 46px)/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    letter-spacing: .3px;
    fill: #0f172a;
  }

  @media (min-width: 900px){
    .wavyMarquee{ height: 110px; transform: rotate(-1.5deg); }
    .wavySvg{ width: 140%; }
    .wavyBand{ fill: rgba(255,255,255,0.45); }
  }
</style>
